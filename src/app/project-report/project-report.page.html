<app-header></app-header>

<ion-content [fullscreen]="true">
  <ion-list class="listTitle">
    <ion-row class="ion-margin">
      <ion-col >
        <ion-text color="primary">
          <h1>{{"PROJECT_REPORT"|translate}}</h1>
        </ion-text>
      </ion-col>
    </ion-row>
  </ion-list>

  <div class="program-selection">
      <h1 (click)="openProgramModal()">{{ "SELECT_PROGRAM" | translate }}
        <ion-icon name="caret-down-outline" class="arrow-icon"></ion-icon>
      </h1>
    @if(selectedProgram){
      <div class="selected-program">
        {{ selectedProgram }}
        <ion-icon name="close-circle" class="cancel-icon" (click)="clearProgramFilter()"></ion-icon>
      </div>
    }
  </div>

<ion-modal [isOpen]="isProgramModel" class="program-modal" (ionModalDidDismiss)="setProgram(false)">
    <ng-template>
      <ion-content [scrollY]="true">
        <ion-grid>
          <ion-row>
            <ion-col size="12">
              @for(item of programList; track $index){
                <ion-item (click)="selectProgram(item)" class="pointer-cursor">
                  <ion-label >{{ item.name }}</ion-label>
                </ion-item>
              }
              <ion-infinite-scroll (ionInfinite)="loadMorePrograms($event)" [disabled]="programList.length === 0">
                <ion-infinite-scroll-content>
                </ion-infinite-scroll-content>
              </ion-infinite-scroll>
            </ion-col>
          </ion-row>
        </ion-grid>
        @if(programList.length == 0){
          <img src="assets/images/no_data.jpg" alt="No data" class="no-data">
        }
        
      </ion-content>
      <div class="modal-buttons">
        <ion-button shape="round" (click)="setProgram(false)" fill="solid">{{"CLOSE"|translate}}</ion-button>
      </div>
    </ng-template>
  </ion-modal>

  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <app-report-header [reportType]="reportType" [reportTitle]="'Project overview'" (emitReportType)="getReportType($event)" (emitReportAction)="getAction($event)"></app-report-header>
        <div>
          <ion-row>
            @for (item of projectsCategories; track $index) {
              <ion-col size="6" sizeSm="3">
                <ion-card class="overview-cards">
                  <div class="overview-div">
                    <img  [src]="item.img" alt="" srcset="">
                  </div>
                  <div class="overview-description">
                    <ion-label>{{item.name}}</ion-label>

                    <ion-label>{{reportData?.projects?.[item.key] ?? 0}}</ion-label>
                  </div>
                </ion-card>
              </ion-col>
            }
          </ion-row>
        </div>
      </ion-col>
      <ion-col size="12" sizeSm="6" style="padding: 10px;">
        <ion-card class="chart-card">
          <h1 >{{"TASK_OVERVIEW"|translate}}</h1>
          <div class="chart-card-div">
            <div class="chart-container">
              <canvas id="doughnutChart" ></canvas>
            </div>
          </div>
        </ion-card>
      </ion-col>
      <ion-col size="12" sizeSm="6" style="padding: 10px;">
        <ion-card class="chart-card">
          <h1 >{{"CATEGORY_OVERVIEW"|translate}}</h1>
          <div class="chart-card-div">
            <div class="chart-container">
              <canvas id="doughnutChartforcategory" ></canvas>
            </div>
          </div>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-modal [isOpen]="isModalOpen" >
    <ng-template>
      <ion-content class="ion-padding">
        <h1 class="modal-heading"><strong>{{"NO_DATA"|translate}}</strong></h1 >
        <p>
          {{"REPORT_NO_DATA"|translate}}
        </p>
        <div class="modal-button">
          <ion-button shape="round" (click)="setOpen(false)" fill="solid">{{"OK"|translate}}</ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>